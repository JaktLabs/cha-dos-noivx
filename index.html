<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ch√° de Casa Nova ‚Äî Adryel & Ketllen</title>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f7f7f7;
      color: #333;
      padding: 20px;
      text-align: center;
    }

    h1 {
      color: #2c6e49;
    }

    .box {
      max-width: 500px;
      margin: 40px auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    textarea {
      resize: vertical;
    }

    button {
      background-color: #2c6e49;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      cursor: pointer;
      margin-top: 15px;
      font-size: 15px;
    }

    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }

    table {
      width: 100%;
      max-width: 700px;
      margin: 30px auto;
      border-collapse: collapse;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #2c6e49;
      color: white;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    a {
      color: #2c6e49;
      text-decoration: none;
      font-weight: 500;
    }

    .footer {
      margin-top: 40px;
      font-size: 0.9em;
      color: #777;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

  <!-- CONFIRMA√á√ÉO DE PRESEN√áA -->
  <div id="confirmacao" class="box">
    <h1>Confirma√ß√£o de Presen√ßa üíö</h1>
    <p>Ficaremos muito felizes com a sua presen√ßa!</p>

    <form onsubmit="confirmarPresenca(event)">
      <input type="text" id="nome" placeholder="Seu nome" required />
      <input type="number" id="qtd" min="1" value="1" required />
      <textarea id="obs" placeholder="Observa√ß√µes (opcional)"></textarea>
      <button type="submit">Confirmar presen√ßa</button>
    </form>
    <p id="mensagem-status" style="display:none; color: green; margin-top: 10px;">
        Reserva feita com sucesso! Aguarde alguns segundos...
    </p>
  </div>

  <!-- LISTA DE PRESENTES -->
  <div id="presentes" class="hidden">
    <h1>Lista de Presentes ‚Äî Ch√° de Casa Nova</h1>
    <p>Escolha um presente e nos ajude a montar nosso lar üè°</p>

    <table id="listaPresentes">
      <thead>
        <tr>
          <th>Presente</th>
          <th>Status</th>
          <th>Sugest√£o</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="4">Carregando...</td></tr>
      </tbody>
    </table>
  </div>

  <div class="footer">Com carinho, Adryel e Ketllen üíç</div>

<script>
const API_BASE = "https://script.google.com/macros/s/AKfycbxIae2rzpF79hJRLNVVlZFxNRLwiPARYqUryS8J-GMGg3YvpULq285BbY7_k9FkxqMy/exec";

// JSONP helper
function jsonpRequest(url, callbackName) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    window[callbackName] = function(data) {
      resolve(data);
      script.remove();
      delete window[callbackName];
    };
    script.onerror = () => reject();
    script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + callbackName;
    document.head.appendChild(script);
  });
}

// CONFIRMAR PRESEN√áA
async function confirmarPresenca(e) {
  e.preventDefault();

  const btn = e.target.querySelector('button');
  const msg = document.getElementById('msgConfirmacao');

  btn.disabled = true;
  btn.textContent = 'Confirmando...';
  msg.textContent = 'Aguarde, isso pode levar at√© 2 segundos ‚è≥';

  const nome = document.getElementById('nome').value;
  const qtd = document.getElementById('qtd').value;
  const obs = document.getElementById('obs').value;

  try {
    const cb = 'cbConf_' + Date.now();
    const url = `${API_BASE}?action=confirmar&nome=${encodeURIComponent(nome)}&qtd=${qtd}&obs=${encodeURIComponent(obs)}`;

    const result = await jsonpRequest(url, cb);

    if (result.status === 'success') {
      msg.textContent = 'Presen√ßa confirmada com sucesso! üíö';
      setTimeout(() => {
        document.getElementById('confirmacao').classList.add('hidden');
        document.getElementById('presentes').classList.remove('hidden');
        carregarPresentes();
      }, 800);
    } else {
      throw new Error();
    }

  } catch {
    msg.textContent = 'Erro ao confirmar. Tente novamente.';
    btn.disabled = false;
    btn.textContent = 'Confirmar presen√ßa';
  }
}

// LISTAR PRESENTES
async function carregarPresentes() {
  const cb = 'cbList_' + Date.now();
  const data = await jsonpRequest(API_BASE + '?action=list', cb);
  renderLista(data);
}

function renderLista(data) {
  const tbody = document.querySelector("#listaPresentes tbody");
  tbody.innerHTML = '';

  data.forEach(item => {
    const tr = document.createElement('tr');

    const tdPres = document.createElement('td');
    tdPres.textContent = item.Presente;

    const tdStatus = document.createElement('td');
    const status = item.Status.toLowerCase();
    tdStatus.textContent = status;
    tdStatus.style.color = status === 'reservado' ? 'red' : 'green';

    const tdLink = document.createElement('td');
    if (item.Link) {
      const a = document.createElement('a');
      a.href = item.Link;
      a.target = '_blank';
      a.textContent = 'Ver sugest√£o';
      tdLink.appendChild(a);
    } else {
      tdLink.textContent = '-';
    }

    const tdAcao = document.createElement('td');
    const btn = document.createElement('button');
    if (status === 'reservado') {
      btn.textContent = 'Reservado';
      btn.disabled = true;
    } else {
      btn.textContent = 'Reservar';
      btn.onclick = () => reservarPresente(item.Presente);
    }

    tdAcao.appendChild(btn);

    tr.append(tdPres, tdStatus, tdLink, tdAcao);
    tbody.appendChild(tr);
  });
}

// RESERVAR PRESENTE
async function reservarPresente(presente) {
  if (!confirm(`Deseja reservar o presente "${presente}"?`)) return;

  const cb = 'cbRes_' + Date.now();
  const url = `${API_BASE}?action=reserve&presente=${encodeURIComponent(presente)}`;
  const result = await jsonpRequest(url, cb);

  alert(result.message || 'Atualizado!');
  carregarPresentes();
}
</script>

</body>
</html>


